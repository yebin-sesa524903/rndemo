// Top-level build file where you can add configuration options common to all sub-projects/modules.

buildscript {
    ext {
        buildToolsVersion = "29.0.3"
        minSdkVersion = 21
        compileSdkVersion = 29
        targetSdkVersion = 29
        RNNKotlinVersion = "1.5.20" // Or any version above 1.3.x
        RNNKotlinStdlib = "kotlin-stdlib-jdk8"
        androidXCore = "1.0.2"
    }

    repositories {
      maven { url 'https://maven.aliyun.com/repository/google' }
      //google()
      jcenter{
        url "https://jcenter.bintray.com/"
      }
      maven {
        url 'https://dl.bintray.com/zouyuhan/maven'
      }
    }
    dependencies {
        classpath("com.android.tools.build:gradle:3.5.4")
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:1.5.20"
        classpath 'de.undercouch:gradle-download-task:2.0.0'
        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
//         classpath 'com.sensorsdata.analytics.android:android-gradle-plugin2:3.4.2'
    }
}
subprojects {
    project.buildscript {
        repositories{
            def ALIYUN_REPOSITORY_URL = 'https://maven.aliyun.com/repository/google'
            def ALIYUN_JCENTER = 'https://maven.aliyun.com/repository/public'
            def ALIYUN_JCENTER_URL = 'https://maven.aliyun.com/repository/jcenter'
            maven {url ALIYUN_REPOSITORY_URL}
            maven {url ALIYUN_JCENTER}
            maven {url ALIYUN_JCENTER_URL}
            mavenLocal()
            google()
//             maven {
//                 url 'https://dl.bintray.com/zouyuhan/maven'
//            }
            whenObjectAdded { repo ->
                if(repo instanceof MavenArtifactRepository){
                   println('----whenObjectAdded:'+repo.url+';'+repo.name+';'+project.name)
                   def url = repo.url.toString()
                   if (url.startsWith('https://maven.google.com') ||
                        url.startsWith('https://jcenter.bintray.com')) {
                       //project.logger.lifecycle "Repository ${repo.url} replaced by $ALIYUN_REPOSITORY_URL."
                       remove repo
                   }
                }
            }
        }
    }
    beforeEvaluate {project ->

    }
   afterEvaluate { project ->
       if (project.hasProperty("android")) {
           android {
               compileSdkVersion 29
               buildToolsVersion '29.0.3'
           }
       }
   }
   project.configurations.all {
       resolutionStrategy.eachDependency { details ->

           if (details.requested.group == 'com.android.support'
                   && !details.requested.name.contains('multidex')) {
               details.useVersion "26.1.0"
           }
       }
   }

   if ((project.plugins.hasPlugin('android') || project.plugins.hasPlugin('android-library'))) {
            android {
               variantFilter { variant ->
                   def names = variant.flavors*.name
                    if (
                        names.contains("reactNative51") ||
                        names.contains("reactNative55") ||
                        names.contains("reactNative56")  ||
                        names.contains("reactNative57") ||
                        names.contains("reactNative57_5") ||
                        names.contains("reactNative60") ||
                        names.contains("reactNative62")
                        ) {
                        setIgnore(true)
                    }
                   }
               }
          }
}

allprojects {p ->
    repositories {
        exclusiveContent{
            filter{
                includeGroup "com.facebook.react"
            }
            forRepository {
                maven {
                    url "$rootDir/../node_modules/react-native/android"
                }
            }
        }
        def ALIYUN_REPOSITORY_URL = 'https://maven.aliyun.com/repository/google'
        def ALIYUN_JCENTER = 'https://maven.aliyun.com/repository/public'
        def ALIYUN_JCENTER_URL = 'https://maven.aliyun.com/repository/jcenter'
        all { ArtifactRepository repo ->
            if(repo instanceof MavenArtifactRepository){
                def url = repo.url.toString()
                if (url.startsWith('https://maven.google.com')) {
                    //project.logger.lifecycle "Repository ${repo.url} replaced by $ALIYUN_REPOSITORY_URL."
                    remove repo
                }
            }
        }
        maven {url ALIYUN_REPOSITORY_URL}
        maven {url ALIYUN_JCENTER}
        maven {url ALIYUN_JCENTER_URL}
//         maven { url 'http://maven.aliyun.com/nexus/content/groups/public' }
        mavenLocal()
        //maven { url 'https://maven.aliyun.com/repository/google' }
        maven {
            // All of React Native (JS, Obj-C sources, Android binaries) is installed from npm
            url("$rootDir/../node_modules/react-native/android")
        }
        maven {
            url("$rootDir/../node_modules/jsc-android/dist")
        }
        //maven {
        //    url 'https://dl.bintray.com/zouyuhan/maven'
        //}
        maven {
            // Local Maven repo containing AARs with JSC library built for Android
            url "$rootDir/../node_modules/jsc-android/dist"
        }

        // ADD THIS
//         maven { url 'https://maven.google.com' }

              // ADD THIS
        maven { url "https://jitpack.io" }

    }
}
